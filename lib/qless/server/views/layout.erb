<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<title>qless<%= (title.length == 0) ? '' : (' | ' + title) %></title>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<meta name="description" content="">
		<meta name="author" content="Dan Lecocq">
		
		<link href="/css/bootstrap.css" rel="stylesheet">
		<link href="/css/bootstrap-responsive.css" rel="stylesheet">
		<link href="/css/docs.css" rel="stylesheet">
		<style type="text/css">
			body {
			padding-top: 60px;
			padding-bottom: 40px;
		}
		</style>
		
		<script type="text/javascript">
		/* This is a helper method to display an alert at the top of the page,
		 * in a vein similar to that of Ruby's flash */
		var flash = function(message, t, duration) {
			var a = $("<div>").addClass("alert").addClass(t || "alert-error").html("<strong>" + message + "</strong>");
			a.append($("<a class='close' data-dismiss='alert' href='#'>&times;</a>"));
			var row = $("<div>").addClass("row").append($("<div>").addClass("span12").append(a));
			$("#alerts").append(row);
			a.alert();
			if (duration) { a.delay(duration).fadeOut(function() { $(this).remove(); }); }
		}
	
		/* This just sets a few options that we use */
		var _ajax = function(obj) {
			$.ajax({
				url: obj.url,
				type: 'POST',
				dataType: 'json',
				data: JSON.stringify(obj.data),
				processData: false,
				success: obj.success || function() {},
				error: obj.error || function() {}
			});
		}
	
		/* This is a helper method to move a job into a queue, and then it will
		 * flash a message to that effect on the page */
		var move = function(jid, queue, cb) {
			_ajax({
				url: '/move',
				data: {id:jid, queue:queue},
				success: function() { flash('Moved ' + jid + ' to ' + queue, 'alert-success', 1500); cb(jid, queue); },
				erorr:   function() { flash('Failed to move ' + jid + ' to ' + queue); }
			});
		}
	
		/* Helper function for retrying a job */
		var retry = function(jid, cb) {
			_ajax({
				url: '/retry',
				data: {id:jid},
				success: function() { flash('Retrying ' + jid, 'alert-success', 1500); if (cb) { cb(jid); } },
				erorr:   function() { flash('Failed to retry ' + jid); }
			});
		}
	
		/* This is a helper method to cancel a job */
		var cancel = function(jid, cb) {
			_ajax({
				url: '/cancel',
				data: [jid],
				success: function() { flash('Canceled ' + jid, null, 1500); if (cb) { cb(jid); } },
				error:   function() { flash('Failed to cancel ' + jid); }
			});
		}
	
		/* This is a helper to start tracking a job, with tags */
		var track = function(jid, tags, cb) {
			_ajax({
				url: '/track',
				data: {id:jid, tags:(tags || [])},
				success: function() { flash('Now tracking ' + jid, 'alert-success', 1500); if (cb) { cb(jid); }  },
				error:   function() { flash('Failed to track ' + jid); }
			});
		}
		
		/* This is a helper to retry all jobs of a certain failure type */
		var retryall = function(type, cb) {
			_ajax({
				url: '/retryall',
				data: {type: type},
				success: function(response) {
					flash('Retrying failures of type ' + type, 'alert-success', 1500);
					if (cb) { 
						for (var i in response) {
							cb(response[i].id);
						}
					}
				},
				error:   function() { flash('Failed to retry failures of type ' + type); }
			});
		}
		
		/* This is a helper to cancel all jobs of a certain failure type */
		var cancelall = function(type, cb) {
			_ajax({
				url: '/cancelall',
				data: {type: type},
				success: function(response) {
					flash('Canceling failures of type ' + type, 'alert-success', 1500);
					if (cb) { 
						for (var i in response) {
							cb(response[i].id);
						}
					}
				},
				error:   function() { flash('Failed to cancel failures of type ' + type); }
			});
		}
	
		/* Helper function to fade out a particular element id */
		var fade = function(jid) {
			$('#job-' + jid).slideUp();
		}
		</script>
		
		<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
		<!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
		<!--[if lt IE 9]>
		<script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
		<![endif]-->
	</head>

	<body>
		<div class="navbar navbar-fixed-top">
			<div class="navbar-inner">
				<div class="container">
					<a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
						<span class="icon-bar"></span>
					</a>
					<a class="brand" href="#">Qless</a>
					<div class="nav-collapse">
						<ul class="nav">
						<% tabs.each do |tab| %>
							<li><a href='<%= tab[:path] %>'><%= tab[:name] %></a></li>
						<% end %>
						</ul>
					</div>
					<!--/.nav-collapse -->
				</div>
			</div>
		</div>

	    <div class="container">
			<%= yield %>
			<!-- <footer class="footer">
				<p>Powered by <a href="http://github.com/seomoz/qless">qless</a> v<%=Qless::VERSION%></p>
			</footer> -->
	    </div> <!-- /container -->

		<!-- Le javascript
		================================================== -->
		<script src="/js/bootstrap.min.js"></script>
		<script src="/js/bootstrap-tab.js"></script>
		<script src="/js/bootstrap-alert.js"></script>
		<script src="/js/bootstrap-tooltip.js"></script>
		<script src="/js/bootstrap-scrollspy.js"></script>
		<!-- 
		<script src="../assets/js/bootstrap-transition.js"></script>
		<script src="../assets/js/bootstrap-modal.js"></script>
		<script src="../assets/js/bootstrap-dropdown.js"></script>
		<script src="../assets/js/bootstrap-popover.js"></script>
		<script src="../assets/js/bootstrap-button.js"></script>
		<script src="../assets/js/bootstrap-collapse.js"></script>
		<script src="../assets/js/bootstrap-carousel.js"></script>
		<script src="../assets/js/bootstrap-typeahead.js"></script>
		-->
	</body>
</html>
